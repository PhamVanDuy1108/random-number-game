<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quay S·ªë May M·∫Øn 1-10 - Multiplayer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
        }

        .game-container {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
        }

        .team-section {
            flex: 1;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .team-section h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .number-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 5em;
            font-weight: bold;
            text-align: center;
            padding: 50px;
            border-radius: 15px;
            margin-bottom: 30px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }

        .number-display.spinning {
            animation: pulse 0.1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .spin-button {
            width: 100%;
            padding: 20px;
            font-size: 1.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .spin-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .spin-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .name-input-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .name-input-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .name-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 2px solid #667eea;
            border-radius: 8px;
            outline: none;
            transition: all 0.3s ease;
        }

        .name-input:focus {
            border-color: #764ba2;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        .name-input::placeholder {
            color: #999;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            background: #28a745;
            color: white;
            border-radius: 20px;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .status-badge.offline {
            background: #dc3545;
        }

        .reset-button {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            font-weight: bold;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
        }

        .reset-button:hover {
            background: #ee5a52;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
        }

        .info-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .info-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .number-box {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .number-box.used {
            background: #dc3545;
            border-color: #dc3545;
            color: white;
            position: relative;
        }

        .number-box.used::after {
            content: "‚úì";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            font-weight: bold;
        }

        .winner-info {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: bold;
        }

        .history-list {
            list-style: none;
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            background: white;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-right: 10px;
        }

        .history-name {
            font-size: 1em;
            color: #333;
            font-weight: 600;
        }

        .history-time {
            font-size: 0.9em;
            color: #6c757d;
        }

        .game-over {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8em;
            }

            .number-display {
                font-size: 3em;
                padding: 30px;
            }

            .numbers-grid {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
                gap: 5px;
            }

            .number-box {
                padding: 10px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∞ Quay S·ªë May M·∫Øn <span class="status-badge" id="statusBadge">üî¥ Offline</span></h1>

        <div class="name-input-section">
            <h3>üë§ Nh·∫≠p t√™n c·ªßa b·∫°n:</h3>
            <input
                type="text"
                id="playerName"
                class="name-input"
                placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A"
                maxlength="30"
            >
        </div>

        <div class="game-container">
            <!-- C·ªôt G√† Chi·∫øn -->
            <div class="team-section">
                <h2>‚öîÔ∏è LEVEL A+ [G√Ä CHI·∫æN]	</h2>
                <div class="number-display" id="numberDisplayCong">?</div>
                <button class="spin-button" id="spinButtonCong" onclick="spinNumber('C√¥ng')">
                    üé≤ QUAY S·ªê (C√¥ng)
                </button>
            </div>

            <!-- C·ªôt G√† G√°y -->
            <div class="team-section">
                <h2>üõ°Ô∏è LEVEL A [G√Ä G√ÅY]	</h2>
                <div class="number-display" id="numberDisplayThu">?</div>
                <button class="spin-button" id="spinButtonThu" onclick="spinNumber('Th·ªß')">
                    üé≤ QUAY S·ªê (Th·ªß)
                </button>
            </div>
        </div>

        <button class="reset-button" onclick="resetGame()">
            üîÑ B·∫ÆT ƒê·∫¶U L·∫†I (Reset t·∫•t c·∫£)
        </button>

        <div class="info-section" style="background: #fff3cd; border: 2px solid #ffc107;">
            <h3 style="color: #856404;">‚öôÔ∏è C·∫•u h√¨nh s·ªë l∆∞·ª£ng (Admin)</h3>
            <div style="display: flex; gap: 10px; align-items: center;">
                <input
                    type="number"
                    id="maxNumberInput"
                    class="name-input"
                    placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng (VD: 30)"
                    min="1"
                    max="1000"
                    style="flex: 1;"
                >
                <button
                    onclick="updateMaxNumber()"
                    style="padding: 15px 30px; font-size: 1.1em; font-weight: bold; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; white-space: nowrap;"
                    onmouseover="this.style.background='#218838'"
                    onmouseout="this.style.background='#28a745'"
                >
                    üíæ L∆∞u
                </button>
            </div>
            <div id="maxNumberStatus" style="margin-top: 10px; font-size: 0.95em; color: #666;">
                Hi·ªán t·∫°i: <strong id="currentMaxNumber">10</strong> s·ªë (t·ª´ 1 ƒë·∫øn <strong id="currentMaxNumber2">10</strong>)
            </div>
        </div>

        <div id="gameOverMessage" class="game-over" style="display: none;">
            üéâ T·∫•t c·∫£ c√°c s·ªë ƒë√£ ƒë∆∞·ª£c quay! Nh·∫•n "B·∫Øt ƒë·∫ßu l·∫°i" ƒë·ªÉ ch∆°i ti·∫øp.
        </div>

        <div class="info-section" style="background: #e7f3ff; border: 2px solid #2196F3;">
            <h3 style="color: #1976D2;">üë• Danh s√°ch c√°c ƒë·ªôi ƒë√£ gh√©p c·∫∑p</h3>
            <div id="teamPairsList" style="font-size: 1.1em;">
                <p style="text-align: center; color: #6c757d; padding: 20px;">
                    Ch∆∞a c√≥ ƒë·ªôi n√†o ƒë∆∞·ª£c gh√©p c·∫∑p
                </p>
            </div>
        </div>

        <div class="info-section">
            <h3>üìä C√°c s·ªë c·ªßa G√† Chi·∫øn</h3>
            <div class="numbers-grid" id="numbersGridCong"></div>
        </div>

        <div class="info-section">
            <h3>üìä C√°c s·ªë c·ªßa G√† G√°y</h3>
            <div class="numbers-grid" id="numbersGridThu"></div>
        </div>

        <div class="info-section">
            <h3>üèÜ L·ªãch s·ª≠ quay s·ªë (Real-time)</h3>
            <ul class="history-list" id="historyList">
                <li style="text-align: center; color: #6c757d; padding: 20px;">
                    ƒêang t·∫£i d·ªØ li·ªáu...
                </li>
            </ul>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase SDK
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, push, onValue, remove } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase Configuration (Free tier)
        const firebaseConfig = {
            apiKey: "AIzaSyAab6XaFgMoMzxGCM2Y9fyhpVOB2IVOFso",
            authDomain: "august-bdb2d.firebaseapp.com",
            databaseURL: "https://august-bdb2d-default-rtdb.firebaseio.com",
            projectId: "august-bdb2d",
            storageBucket: "august-bdb2d.firebasestorage.app",
            messagingSenderId: "1058181113741",
            appId: "1:1058181113741:web:430906f1c0883e751d3fc4"
        };

        // Initialize Firebase
        let app, database;
        let isFirebaseReady = false;

        try {
            app = initializeApp(firebaseConfig);
            database = getDatabase(app);
            isFirebaseReady = true;
            updateStatus(true);
            console.log('‚úÖ Firebase connected');
        } catch (error) {
            console.error('‚ùå Firebase error:', error);
            updateStatus(false);
            alert('‚ö†Ô∏è Kh√¥ng th·ªÉ k·∫øt n·ªëi Firebase. Vui l√≤ng c·∫•u h√¨nh Firebase ho·∫∑c s·ª≠ d·ª•ng ch·∫ø ƒë·ªô offline.');
        }

        // Global variables
        window.gameHistory = [];
        window.isSpinning = false;
        window.database = database;
        window.isFirebaseReady = isFirebaseReady;
        window.adminPassword = null; // S·∫Ω ƒë∆∞·ª£c t·∫£i t·ª´ Firebase
        window.maxNumber = 10; // M·∫∑c ƒë·ªãnh l√† 10, s·∫Ω ƒë∆∞·ª£c t·∫£i t·ª´ Firebase
        // Tr·∫°ng th√°i game cho t·ª´ng ƒë·ªôi
        window.gameState = {
            'C√¥ng': { used: [] },
            'Th·ªß': { used: [] }
        };

        // Update connection status
        function updateStatus(isOnline) {
            const badge = document.getElementById('statusBadge');
            if (isOnline) {
                badge.textContent = 'üü¢ Online';
                badge.classList.remove('offline');
            } else {
                badge.textContent = 'üî¥ Offline';
                badge.classList.add('offline');
            }
        }
        window.updateStatus = updateStatus;

        // Listen to Firebase data changes
        if (isFirebaseReady) {
            // Expose Firebase functions to global scope
            window.firebaseRef = ref;
            window.firebasePush = push;
            window.firebaseSet = set;
            window.firebaseRemove = remove;

            // Load admin password from Firebase
            const passwordRef = ref(database, 'password');
            onValue(passwordRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    window.adminPassword = data;
                    console.log('üîí Admin password loaded from Firebase');
                } else {
                    console.warn('‚ö†Ô∏è No password found in Firebase. Please set "password" key in database.');
                }
            });

            // Load maxNumber from Firebase
            const maxNumberRef = ref(database, 'maxNumber');
            onValue(maxNumberRef, (snapshot) => {
                const data = snapshot.val();
                if (data && typeof data === 'number' && data > 0) {
                    window.maxNumber = data;
                } else {
                    window.maxNumber = 10; // Default
                }
                console.log(`üé≤ Max number set to: ${window.maxNumber}`);
                updateMaxNumberDisplay();
                // Ph·∫£i g·ªçi updateUI sau khi c√≥ maxNumber v√† history
                updateUIFromHistory();
            });

            const historyRef = ref(database, 'gameHistory');
            onValue(historyRef, (snapshot) => {
                const data = snapshot.val();
                window.gameHistory = data ? Object.values(data).sort((a, b) => b.timestamp - a.timestamp) : [];

                // C·∫≠p nh·∫≠t tr·∫°ng th√°i v√† giao di·ªán t·ª´ l·ªãch s·ª≠
                updateUIFromHistory();
            });
        } else {
            // Offline mode - use localStorage
            initGameOffline();
        }

        function updateUIFromHistory() {
            // Reset tr·∫°ng th√°i
            window.gameState['C√¥ng'].used = [];
            window.gameState['Th·ªß'].used = [];

            // X√¢y d·ª±ng l·∫°i tr·∫°ng th√°i t·ª´ l·ªãch s·ª≠
            for (const item of window.gameHistory) {
                if (item.team === 'C√¥ng') {
                    window.gameState['C√¥ng'].used.push(item.number);
                } else if (item.team === 'Th·ªß') {
                    window.gameState['Th·ªß'].used.push(item.number);
                }
            }

            updateAllGrids();
            updateHistory();
            checkGameOver();
            updateTeamPairs(); // C·∫≠p nh·∫≠t danh s√°ch c√°c ƒë·ªôi gh√©p c·∫∑p
        }

        // Initialize offline mode
        function initGameOffline() {
            const savedData = localStorage.getItem('gameHistory');
            const savedMaxNumber = localStorage.getItem('maxNumber');

            if (savedMaxNumber) {
                window.maxNumber = parseInt(savedMaxNumber);
            }
            window.gameHistory = savedData ? JSON.parse(savedData) : [];

            updateUIFromHistory();
            updateMaxNumberDisplay();
        }
        window.initGameOffline = initGameOffline;

        // Save to Firebase
        window.saveToFirebase = async function(number, playerName, team) {
            const newEntry = {
                number: number,
                playerName: playerName,
                team: team,
                timestamp: Date.now(),
                time: new Date().toLocaleString('vi-VN')
            };

            if (!window.isFirebaseReady) {
                // Offline mode - save to localStorage
                window.gameHistory.unshift(newEntry);
                localStorage.setItem('gameHistory', JSON.stringify(window.gameHistory));
                updateUIFromHistory(); // C·∫≠p nh·∫≠t UI ngay l·∫≠p t·ª©c
                return;
            }

            const historyRef = window.firebaseRef(window.database, 'gameHistory');
            const newHistoryRef = window.firebasePush(historyRef);
            await window.firebaseSet(newHistoryRef, newEntry);
        };

        // Reset game
        window.resetGameFirebase = async function() {
            // Ki·ªÉm tra n·∫øu ch∆∞a load password t·ª´ Firebase
            if (window.isFirebaseReady && !window.adminPassword) {
                alert('‚ö†Ô∏è ƒêang t·∫£i c·∫•u h√¨nh t·ª´ Firebase, vui l√≤ng th·ª≠ l·∫°i sau gi√¢y l√°t...');
                return;
            }

            // Y√™u c·∫ßu m·∫≠t kh·∫©u
            const password = prompt('üîí Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ reset (ch·ªâ Admin):');

            if (password === null) {
                // User clicked Cancel
                return;
            }

            // Ki·ªÉm tra m·∫≠t kh·∫©u t·ª´ Firebase (ho·∫∑c fallback cho offline mode)
            const correctPassword = window.isFirebaseReady ? window.adminPassword : 'August';

            if (password !== correctPassword) {
                alert('‚ùå M·∫≠t kh·∫©u sai! Kh√¥ng th·ªÉ reset.');
                return;
            }

            // Confirm reset
            if (!confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën X√ìA T·∫§T C·∫¢ d·ªØ li·ªáu v√† b·∫Øt ƒë·∫ßu l·∫°i? H√†nh ƒë·ªông n√†y s·∫Ω ·∫£nh h∆∞·ªüng ƒë·∫øn T·∫§T C·∫¢ ng∆∞·ªùi ch∆°i!')) {
                return;
            }

            if (window.isFirebaseReady) {
                const historyRef = window.firebaseRef(window.database, 'gameHistory');
                await window.firebaseRemove(historyRef);
            } else {
                localStorage.removeItem('gameHistory');
                window.initGameOffline();
            }

            document.getElementById('numberDisplayCong').textContent = '?';
            document.getElementById('numberDisplayThu').textContent = '?';
            alert('‚úÖ ƒê√£ reset th√†nh c√¥ng!');
        };

        // Expose Firebase functions to global scope
        window.firebaseRef = ref;
        window.firebasePush = push;
        window.firebaseSet = set;
        window.firebaseRemove = remove;
    </script>

    <script>
        // Kh·ªüi t·∫°o game
        function initGame() {
            if (!window.isFirebaseReady) {
                window.initGameOffline();
            }
            document.getElementById('numberDisplayCong').textContent = '?';
            document.getElementById('numberDisplayThu').textContent = '?';
            updateMaxNumberDisplay();
        }

        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã maxNumber
        function updateMaxNumberDisplay() {
            const maxNum = window.maxNumber || 10;
            document.getElementById('currentMaxNumber').textContent = maxNum;
            document.getElementById('currentMaxNumber2').textContent = maxNum;
            document.getElementById('maxNumberInput').placeholder = `Nh·∫≠p s·ªë l∆∞·ª£ng (Hi·ªán t·∫°i: ${maxNum})`;
        }

        // C·∫≠p nh·∫≠t maxNumber (Admin)
        async function updateMaxNumber() {
            try {
                // Ki·ªÉm tra Firebase ready
                if (!window.isFirebaseReady) {
                    alert('‚ö†Ô∏è Ch·∫ø ƒë·ªô offline kh√¥ng h·ªó tr·ª£ thay ƒë·ªïi c·∫•u h√¨nh. Vui l√≤ng k·∫øt n·ªëi Firebase.');
                    return;
                }

                // Ki·ªÉm tra password loaded
                if (!window.adminPassword) {
                    alert('‚ö†Ô∏è ƒêang t·∫£i c·∫•u h√¨nh t·ª´ Firebase, vui l√≤ng th·ª≠ l·∫°i sau gi√¢y l√°t...');
                    console.error('Admin password not loaded yet');
                    return;
                }

                // L·∫•y gi√° tr·ªã input
                const inputValue = document.getElementById('maxNumberInput').value;
                const newMaxNumber = parseInt(inputValue);

                // Validate
                if (!inputValue || isNaN(newMaxNumber) || newMaxNumber < 1 || newMaxNumber > 1000) {
                    alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p s·ªë t·ª´ 1 ƒë·∫øn 1000!');
                    return;
                }

                // Y√™u c·∫ßu m·∫≠t kh·∫©u admin
                const password = prompt('üîí Nh·∫≠p m·∫≠t kh·∫©u Admin ƒë·ªÉ thay ƒë·ªïi c·∫•u h√¨nh:');

                if (password === null) {
                    return; // User clicked Cancel
                }

                // Debug log
                console.log('Entered password:', password);
                console.log('Expected password:', window.adminPassword);
                console.log('Password type:', typeof window.adminPassword);

                // Chuy·ªÉn ƒë·ªïi c·∫£ hai v·ªÅ string ƒë·ªÉ so s√°nh
                const enteredPassword = String(password).trim();
                const expectedPassword = String(window.adminPassword).trim();

                if (enteredPassword !== expectedPassword) {
                    alert('‚ùå M·∫≠t kh·∫©u sai! Kh√¥ng th·ªÉ thay ƒë·ªïi c·∫•u h√¨nh.');
                    console.error('Password mismatch');
                    return;
                }

                // Confirm change
                if (!confirm(`‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën thay ƒë·ªïi s·ªë l∆∞·ª£ng t·ª´ ${window.maxNumber} th√†nh ${newMaxNumber}?\n\nL∆∞u √Ω: N·∫øu ƒë√£ c√≥ l·ªãch s·ª≠ quay s·ªë, c√°c s·ªë ngo√†i ph·∫°m vi m·ªõi s·∫Ω kh√¥ng hi·ªÉn th·ªã.`)) {
                    return;
                }

                // L∆∞u v√†o Firebase
                const maxNumberRef = window.firebaseRef(window.database, 'maxNumber');
                await window.firebaseSet(maxNumberRef, newMaxNumber);

                // Clear input
                document.getElementById('maxNumberInput').value = '';

                alert(`‚úÖ ƒê√£ c·∫≠p nh·∫≠t th√†nh c√¥ng! S·ªë l∆∞·ª£ng m·ªõi: ${newMaxNumber}`);

            } catch (error) {
                console.error('Error updating maxNumber:', error);
                alert(`‚ùå L·ªói khi c·∫≠p nh·∫≠t: ${error.message}\n\nVui l√≤ng th·ª≠ l·∫°i!`);
            }
        }

        // C·∫≠p nh·∫≠t l∆∞·ªõi c√°c s·ªë cho c·∫£ 2 ƒë·ªôi
        function updateAllGrids() {
            updateSingleGrid('C√¥ng', document.getElementById('numbersGridCong'));
            updateSingleGrid('Th·ªß', document.getElementById('numbersGridThu'));
        }

        // C·∫≠p nh·∫≠t m·ªôt l∆∞·ªõi s·ªë c·ª• th·ªÉ
        function updateSingleGrid(team, gridElement) {
            if (!gridElement) return;
            gridElement.innerHTML = '';
            const usedNumbers = window.gameState[team].used;

            for (let i = 1; i <= window.maxNumber; i++) {
                const box = document.createElement('div');
                box.className = 'number-box';
                box.textContent = i;

                if (usedNumbers.includes(i)) {
                    box.classList.add('used');
                    // T√¨m ng∆∞·ªùi ch∆°i ƒë√£ quay s·ªë n√†y
                    const historyEntry = window.gameHistory.find(h => h.team === team && h.number === i);
                    if (historyEntry) {
                        box.title = `ƒê√£ quay b·ªüi: ${historyEntry.playerName}`;
                    }
                }
                gridElement.appendChild(box);
            }
        }

        // C·∫≠p nh·∫≠t l·ªãch s·ª≠
        function updateHistory() {
            const historyList = document.getElementById('historyList');

            if (window.gameHistory.length === 0) {
                historyList.innerHTML = `
                    <li style="text-align: center; color: #6c757d; padding: 20px;">
                        Ch∆∞a c√≥ l·ªãch s·ª≠
                    </li>
                `;
                return;
            }

            historyList.innerHTML = window.gameHistory.map((item, index) => `
                <li class="history-item" style="border-left-color: ${item.team === 'C√¥ng' ? '#dc3545' : '#007bff'};">
                    <span>
                        <span class="history-number" style="color: ${item.team === 'C√¥ng' ? '#dc3545' : '#007bff'};">#${item.number}</span>
                        <span class="history-name">üë§ ${item.playerName || '·∫®n danh'} (${item.team})</span>
                    </span>
                    <span class="history-time">
                        ${item.time || 'N/A'}
                    </span>
                </li>
            `).join('');
        }

        // C·∫≠p nh·∫≠t danh s√°ch c√°c ƒë·ªôi ƒë√£ gh√©p c·∫∑p
        function updateTeamPairs() {
            const teamPairsList = document.getElementById('teamPairsList');

            // T·∫°o object ƒë·ªÉ l∆∞u c√°c s·ªë ƒë√£ ƒë∆∞·ª£c quay b·ªüi t·ª´ng ƒë·ªôi
            const congNumbers = {};
            const thuNumbers = {};

            // Ph√¢n lo·∫°i c√°c s·ªë theo ƒë·ªôi v√† ng∆∞·ªùi ch∆°i
            window.gameHistory.forEach(item => {
                if (item.team === 'C√¥ng') {
                    congNumbers[item.number] = item.playerName;
                } else if (item.team === 'Th·ªß') {
                    thuNumbers[item.number] = item.playerName;
                }
            });

            // T√¨m c√°c s·ªë ƒë√£ ƒë∆∞·ª£c c·∫£ hai ƒë·ªôi quay
            const pairedNumbers = [];
            for (const num in congNumbers) {
                if (thuNumbers[num]) {
                    pairedNumbers.push({
                        number: parseInt(num),
                        congPlayer: congNumbers[num],
                        thuPlayer: thuNumbers[num]
                    });
                }
            }

            // S·∫Øp x·∫øp theo s·ªë tƒÉng d·∫ßn
            pairedNumbers.sort((a, b) => a.number - b.number);

            // Hi·ªÉn th·ªã danh s√°ch c√°c ƒë·ªôi
            if (pairedNumbers.length === 0) {
                teamPairsList.innerHTML = `
                    <p style="text-align: center; color: #6c757d; padding: 20px;">
                        Ch∆∞a c√≥ ƒë·ªôi n√†o ƒë∆∞·ª£c gh√©p c·∫∑p
                    </p>
                `;
            } else {
                teamPairsList.innerHTML = pairedNumbers.map((pair, index) => `
                    <div style="background: white; padding: 15px; margin-bottom: 10px; border-radius: 10px; border-left: 5px solid #2196F3;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="flex: 1;">
                                <strong style="font-size: 1.3em; color: #2196F3;">üèÜ ƒê·ªôi ${pair.number}</strong>
                            </div>
                        </div>
                        <div style="margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div style="background: #ffebee; padding: 10px; border-radius: 8px; border-left: 3px solid #dc3545;">
                                <div style="font-weight: bold; color: #dc3545; margin-bottom: 5px;">‚öîÔ∏è G√† Chi·∫øn</div>
                                <div style="color: #333;">üë§ ${pair.congPlayer || '·∫®n danh'}</div>
                            </div>
                            <div style="background: #e3f2fd; padding: 10px; border-radius: 8px; border-left: 3px solid #007bff;">
                                <div style="font-weight: bold; color: #007bff; margin-bottom: 5px;">üõ°Ô∏è G√† G√°y</div>
                                <div style="color: #333;">üë§ ${pair.thuPlayer || '·∫®n danh'}</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Quay s·ªë
        async function spinNumber(team) {
            const teamState = window.gameState[team];
            const availableNumbers = Array.from({ length: window.maxNumber }, (_, i) => i + 1)
                                          .filter(n => !teamState.used.includes(n));

            // Ki·ªÉm tra t√™n ng∆∞·ªùi ch∆°i
            const playerNameInput = document.getElementById('playerName');
            const playerName = playerNameInput.value.trim();

            if (!playerName) {
                alert('‚ö†Ô∏è Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n tr∆∞·ªõc khi quay s·ªë!');
                playerNameInput.focus();
                return;
            }

            if (window.isSpinning || availableNumbers.length === 0) {
                alert(`üéâ ƒê·ªôi ${team} ƒë√£ quay h·∫øt s·ªë!`);
                return;
            }

            window.isSpinning = true;
            const display = team === 'C√¥ng' ? document.getElementById('numberDisplayCong') : document.getElementById('numberDisplayThu');
            const buttonCong = document.getElementById('spinButtonCong');
            const buttonThu = document.getElementById('spinButtonThu');

            buttonCong.disabled = true;
            buttonThu.disabled = true;
            display.classList.add('spinning');

            // Hi·ªáu ·ª©ng quay s·ªë
            let counter = 0;
            const spinInterval = setInterval(async () => {
                // Hi·ªÉn th·ªã s·ªë ng·∫´u nhi√™n trong to√†n b·ªô d·∫£i s·ªë ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng
                const randomEffectNumber = Math.floor(Math.random() * window.maxNumber) + 1;
                display.textContent = randomEffectNumber;
                counter++;

                if (counter >= 20) {
                    clearInterval(spinInterval);

                    // Ch·ªçn s·ªë ng·∫´u nhi√™n t·ª´ c√°c s·ªë C√íN L·∫†I c·ªßa ƒë·ªôi ƒë√≥
                    const randomIndex = Math.floor(Math.random() * availableNumbers.length);
                    const selectedNumber = availableNumbers[randomIndex];

                    // Hi·ªÉn th·ªã s·ªë tr√∫ng
                    display.textContent = selectedNumber;
                    display.classList.remove('spinning');

                    // L∆∞u v√†o Firebase/LocalStorage
                    await window.saveToFirebase(selectedNumber, playerName, team);

                    // Clear input
                    playerNameInput.value = '';

                    window.isSpinning = false;
                    // K√≠ch ho·∫°t l·∫°i c√°c n√∫t sau khi quay xong
                    checkGameOver();
                }
            }, 100);
        }

        // Ki·ªÉm tra game over v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t
        function checkGameOver() {
            const availableCong = window.maxNumber - window.gameState['C√¥ng'].used.length;
            const availableThu = window.maxNumber - window.gameState['Th·ªß'].used.length;

            const buttonCong = document.getElementById('spinButtonCong');
            const buttonThu = document.getElementById('spinButtonThu');

            buttonCong.disabled = window.isSpinning || availableCong === 0;
            buttonThu.disabled = window.isSpinning || availableThu === 0;

            if (availableCong === 0 && availableThu === 0) {
                document.getElementById('gameOverMessage').style.display = 'block';
            } else {
                document.getElementById('gameOverMessage').style.display = 'none';
            }
        }

        // Reset game
        async function resetGame() {
            await window.resetGameFirebase();
        }

        // Kh·ªüi t·∫°o khi t·∫£i trang
        window.onload = initGame;
    </script>
</body>
</html>
